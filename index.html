<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>My Wallet</title>
    <style>
        /* --- æ¨£å¼å€ --- */
        :root { --bg-color: #F8F9FD; --card-bg: #FFFFFF; --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%); --text-main: #2D3748; --text-sub: #718096; --input-bg: #EDF2F7; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background-color: var(--bg-color); color: var(--text-main); margin: 0; padding-bottom: 150px; }
        
        /* ç™»å…¥é®ç½© */
        #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #f8f9fd; z-index: 99999; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 30px; box-sizing: border-box; transition: opacity 0.3s; }
        .login-box { width: 100%; max-width: 320px; text-align: center; background: white; padding: 30px; border-radius: 24px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
        .login-title { font-size: 22px; font-weight: 800; margin-bottom: 10px; color: #333; }
        .login-input { width: 100%; padding: 15px; background: #edf2f7; border: none; border-radius: 12px; font-size: 24px; text-align: center; outline: none; margin: 20px 0; letter-spacing: 4px; font-weight: bold; }
        .login-btn { width: 100%; padding: 15px; background: var(--primary-gradient); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .login-btn:active { transform: scale(0.95); }
        .login-btn:disabled { opacity: 0.7; cursor: not-allowed; }
        .error-msg { color: #ff4757; font-size: 13px; margin-top: 15px; min-height: 20px; }

        /* ä¸»ä»‹é¢æ¨£å¼ */
        .hero { padding: 20px 24px; }
        .header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        
        /* App æ¨™é¡Œå’Œç‰ˆæœ¬è™Ÿç¾¤çµ„ */
        .app-title-group { display: flex; align-items: flex-end; gap: 8px; }
        .app-title { font-size: 24px; font-weight: 800; }
        .app-version {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-sub); 
            margin-bottom: 2px;
            cursor: pointer; 
        }

        .header-actions { display: flex; align-items: center; gap: 8px; }
        select#monthSelector { border: none; background: transparent; font-size: 16px; font-weight: 600; color: #5a67d8; outline: none; text-align: right; }
        .btn-logout { background: #fff; color: #FF3B30; border: 1px solid #FF3B30; padding: 6px 14px; border-radius: 20px; font-size: 13px; font-weight: 600; cursor: pointer; }
        .total-card { background: var(--primary-gradient); border-radius: 24px; padding: 30px 25px; color: white; box-shadow: 0 20px 25px -5px rgba(102, 126, 234, 0.4); position: relative; overflow: hidden; }
        .card-label { font-size: 13px; opacity: 0.8; letter-spacing: 1px; margin-bottom: 8px; }
        .total-amount { font-size: 42px; font-weight: 700; letter-spacing: -1px; }
        .input-section { padding: 0 24px; margin-top: 10px; }
        .input-group { background: var(--card-bg); border-radius: 20px; padding: 20px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.05); display: flex; flex-direction: column; gap: 15px; }
        .bill-month-row { display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid #eee; padding-bottom: 12px; margin-bottom: 5px; }
        .bill-month-label { font-size: 14px; color: var(--text-sub); font-weight: 600; }
        select#billMonthInput { border: none; background: #EDF2F7; padding: 6px 12px; border-radius: 8px; font-size: 15px; font-weight: 600; color: var(--text-main); outline: none; }
        .form-row { display: flex; gap: 12px; }
        .form-col { flex: 1; display: flex; flex-direction: column; gap: 5px; position: relative; }
        label { font-size: 12px; color: var(--text-sub); font-weight: 600; margin-left: 4px; }
        input, select.form-select { width: 100%; background: var(--input-bg); border: none; padding: 14px; border-radius: 12px; font-size: 16px; color: var(--text-main); box-sizing: border-box; outline: none; appearance: none; }
        .suggestions-box { position: absolute; top: 105%; left: 0; width: 100%; max-height: 250px; overflow-y: auto; background: white; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.15); z-index: 100; display: none; border: 1px solid #eee; }
        .suggestions-box.show { display: block; }
        .suggestion-item { padding: 12px 16px; font-size: 15px; border-bottom: 1px solid #f5f5f5; color: #333; cursor: pointer; }
        .btn-submit { width: 100%; background: var(--text-main); color: white; border: none; padding: 16px; border-radius: 16px; font-size: 16px; font-weight: 600; cursor: pointer; margin-top: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); transition: transform 0.1s; }
        .btn-submit:disabled { opacity: 0.6; }
        .list-section { padding: 30px 24px; }
        .section-title { font-size: 18px; font-weight: 700; margin-bottom: 15px; display: flex; justify-content: space-between; }
        .transaction-item { background: var(--card-bg); border-radius: 16px; padding: 18px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        .t-info { display: flex; flex-direction: column; gap: 6px; }
        .t-bank { font-size: 16px; font-weight: 700; color: var(--text-main); }
        .tags-row { display: flex; gap: 6px; align-items: center; flex-wrap: wrap; }
        .tag-date { font-size: 12px; color: #4299e1; background: #ebf8ff; padding: 3px 8px; border-radius: 6px; font-weight: 600; display: inline-flex; align-items: center; }
        .t-note { font-size: 13px; color: var(--text-sub); }
        .t-amount-group { display: flex; align-items: center; gap: 15px; } 
        .t-amount { font-size: 18px; font-weight: 700; }
        .btn-delete { color: #FF3B30; background: none; border: none; font-size: 1.2rem; cursor: pointer; opacity: 0.7; padding: 0 5px; } 
        .loading-state { text-align: center; padding: 40px; color: var(--text-sub); font-size: 14px; }
        
        /* â”€â”€â”€ Custom Modal Styles â”€â”€â”€ */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.5); z-index: 999999;
            display: none; justify-content: center; align-items: center;
        }
        .modal-box {
            background: white; border-radius: 12px;
            padding: 25px; width: 80%; max-width: 350px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transform: scale(0.9); opacity: 0; transition: all 0.2s ease-in-out;
        }
        .modal-overlay.show { display: flex; }
        .modal-overlay.show .modal-box {
            transform: scale(1); opacity: 1;
        }
        .modal-title { font-size: 18px; font-weight: 700; color: var(--text-main); margin-bottom: 10px; }
        .modal-message { font-size: 15px; color: #555; margin-bottom: 20px; line-height: 1.5; }
        .modal-actions { display: flex; justify-content: flex-end; gap: 10px; }
        .modal-btn { padding: 10px 18px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.1s; }
        .modal-btn.primary { background: var(--text-main); color: white; }
        .modal-btn.secondary { background: #E2E8F0; color: var(--text-main); }
    </style>
</head>
<body>

    <div id="loginOverlay">
        <div class="login-box">
            <div class="login-title">å®‰å…¨é–å®š ğŸ”’</div>
            <div style="color:#888; font-size:14px; margin-bottom:10px;">è«‹è¼¸å…¥å¯†ç¢¼ä»¥å­˜å–è³‡æ–™</div>
            <input type="tel" id="passwordInput" class="login-input" placeholder="â€¢â€¢â€¢â€¢" maxlength="8">
            <button id="loginBtn" class="login-btn" onclick="verifyLogin()">è§£é–</button>
            <div id="loginError" class="error-msg"></div>
        </div>
    </div>
    
    <div id="customModal" class="modal-overlay">
        <div class="modal-box">
            <div id="modalTitle" class="modal-title"></div>
            <div id="modalMessage" class="modal-message"></div>
            <div class="modal-actions" id="modalActions">
                </div>
        </div>
    </div>

    <div class="hero">
        <div class="header-row">
            <div class="app-title-group">
                <div class="app-title">å¸³å–®ç®¡å®¶</div>
                <span class="app-version" onclick="forceCacheClear()">v5.2</span>
            </div>
            <div class="header-actions">
                <select id="monthSelector" onchange="filterData()"></select>
                <button class="btn-logout" onclick="logout()">ç™»å‡º</button>
            </div>
        </div>
        <div class="total-card">
            <div class="card-label">æœ¬æœˆç¸½æ”¯å‡º</div>
            <div class="total-amount" id="totalAmount">$0</div>
        </div>
    </div>

    <div class="input-section">
        <div class="input-group">
            <div class="bill-month-row">
                <span class="bill-month-label">è¨˜å¸³æœˆä»½</span>
                <select id="billMonthInput"></select>
            </div>
            <div class="form-row">
                <div class="form-col" style="flex: 3;">
                    <label>éŠ€è¡Œ / å¡åˆ¥</label>
                    <input type="text" id="bank" placeholder="æœå°‹..." autocomplete="off">
                    <div id="bankSuggestions" class="suggestions-box"></div>
                </div>
                <div class="form-col" style="flex: 2;">
                    <label>é‡‘é¡</label>
                    <input type="number" id="amount" inputmode="decimal" placeholder="$0">
                </div>
            </div>
            <div class="form-row">
                <div class="form-col" style="flex: 2;">
                    <label>æ‰£æ¬¾æ—¥</label>
                    <select id="paymentDate" class="form-select">
                        <option value="" disabled selected>é¸æ“‡</option>
                    </select>
                </div>
                <div class="form-col" style="flex: 3;">
                    <label>å‚™è¨» (é¸å¡«)</label>
                    <input type="text" id="note" placeholder="æ¶ˆè²»é …ç›®...">
                </div>
            </div>
            <button class="btn-submit" id="submitBtn" onclick="submitData()">ï¼‹ ç¢ºèªè¨˜å¸³</button>
        </div>
    </div>

    <div class="list-section">
        <div class="section-title">
            <span>æ˜ç´°åˆ—è¡¨</span>
            <span style="font-size:12px; font-weight:normal; background:#eee; padding:4px 8px; border-radius:10px;" id="count">0 ç­†</span>
        </div>
        <div id="listContainer"></div>
    </div>

<script>
    // ==========================================
    // ğŸ”´ ä½ çš„å°ˆå±¬ç¶²å€ 
    const API_URL = "https://script.google.com/macros/s/AKfycby60jdswu4PguQ0YNMpYdfdOewU-YscwRvOpcVxZhV7KNpwhVzSO7tJ8vNx1fPmw_tjGw/exec";
    // ==========================================

    const BANK_LIST = [ "ä¸­åœ‹ä¿¡è¨—", "ä¸­ä¿¡ LinePay", "ä¸­ä¿¡ è‹±é›„è¯ç›Ÿå¡", "ä¸­ä¿¡ å•†æ—…éˆ¦é‡‘", "ç‰å±±éŠ€è¡Œ", "ç‰å±± UBear", "ç‰å±± Piå¡", "ç‰å±± Onlyå¡", "ç‰å±± å®¶æ¨‚ç¦å¡", "åœ‹æ³°ä¸–è¯", "åœ‹æ³° Cubeå¡", "åœ‹æ³° CUBE (ç©æ•¸ä½)", "åœ‹æ³° CUBE (æ¨‚é¥—è³¼)", "å°æ–°éŠ€è¡Œ", "å°æ–° GoGoå¡", "å°æ–° FlyGo", "å°æ–° ç«ç‘°å¡", "å¯Œé‚¦éŠ€è¡Œ", "å¯Œé‚¦ Jå¡", "å¯Œé‚¦ momoå¡", "å¯Œé‚¦ Costcoå¡", "æ°¸è±éŠ€è¡Œ", "æ°¸è± å¤§æˆ¶å¡", "æ°¸è± Sportå¡", "è¯é‚¦éŠ€è¡Œ", "è¯é‚¦ å‰é¶´å¡", "è¯é‚¦ è³´é»å¡", "æ˜Ÿå±•éŠ€è¡Œ", "æ˜Ÿå±• ecoæ°¸çºŒå¡", "åŒ¯è±éŠ€è¡Œ", "åŒ¯è± æ—…äººå¡", "åŒ¯è± åŒ¯é‘½å¡", "æ¸£æ‰“éŠ€è¡Œ", "ç¬¬ä¸€éŠ€è¡Œ", "ä¸€éŠ€ iLEO", "è¯å—éŠ€è¡Œ", "è¯å— SnYå¡", "å…†è±éŠ€è¡Œ", "å…ƒå¤§éŠ€è¡Œ" ];
    
    let allData = [];
    let USER_PASSWORD = "";

    document.addEventListener('DOMContentLoaded', () => {
        const savedPass = localStorage.getItem('myBillAppPassword');
        
        initMonthDropdown('monthSelector'); 
        initMonthDropdown('billMonthInput');
        initDateDropdown(); 
        setDefaultInputMonth();
        setupBankAutocomplete();
        
        if(savedPass) {
            document.getElementById('passwordInput').value = savedPass;
            verifyLogin(true); 
        }
    });

    // â”€â”€â”€ æ ¸å¿ƒï¼šè‡ªè¨‚å½ˆçª—ç³»çµ± â”€â”€â”€
    function showCustomDialog(title, message, buttons) {
        const modal = document.getElementById('customModal');
        document.getElementById('modalTitle').innerText = title;
        document.getElementById('modalMessage').innerHTML = message;
        const actions = document.getElementById('modalActions');
        actions.innerHTML = ''; 

        buttons.forEach(btn => {
            const button = document.createElement('button');
            button.className = 'modal-btn ' + (btn.class || 'primary');
            button.innerText = btn.text;
            button.onclick = () => {
                modal.classList.remove('show');
                if (btn.action) {
                    btn.action();
                }
            };
            actions.appendChild(button);
        });

        modal.classList.add('show');
    }

    function showCustomAlert(message, title = 'ç³»çµ±æç¤º') {
        showCustomDialog(title, message, [{ text: 'ç¢ºå®š', class: 'primary' }]);
    }

    function showCustomConfirmation(message, title, onConfirm) {
        showCustomDialog(title, message, [
            { text: 'å–æ¶ˆ', class: 'secondary' },
            { text: 'ç¢ºå®š', class: 'primary', action: onConfirm }
        ]);
    }
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    function forceCacheClear() {
        showCustomConfirmation('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰ App å¿«å–ä¸¦å¼·åˆ¶æ›´æ–°ç‰ˆæœ¬å—ï¼Ÿ (éœ€è¦é‡æ–°ç™»å…¥)', 'å¼·åˆ¶æ›´æ–°', () => {
            localStorage.removeItem('myBillAppPassword');
            location.reload(true); 
        });
    }

    async function deleteRecord(rowIndex) {
        // ä¿®æ­£ï¼šä½¿ç”¨è‡ªè¨‚å½ˆçª—
        showCustomConfirmation('ç¢ºå®šè¦åˆªé™¤é€™ç­†ç´€éŒ„å—ï¼Ÿ', 'ç¢ºèªåˆªé™¤', async () => {
            
            const deleteObj = { 
                password: USER_PASSWORD, 
                action: 'delete',
                rowIndex: rowIndex
            };

            const btn = document.getElementById('submitBtn');
            const originalText = btn.innerText;
            btn.disabled = true;
            btn.innerText = 'åˆªé™¤ä¸­...';

            try {
                await fetch(API_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(deleteObj)
                });
                
                setTimeout(() => {
                    loadData(); 
                    btn.disabled = false;
                    btn.innerText = originalText;
                }, 1000); 

            } catch(error) {
                showCustomAlert('åˆªé™¤è«‹æ±‚å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯ã€‚', 'éŒ¯èª¤');
                btn.disabled = false;
                btn.innerText = originalText;
                loadData();
            }
        });
    }
    
    function logout() {
        showCustomConfirmation('ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿä¸‹æ¬¡éœ€è¦é‡æ–°è¼¸å…¥å¯†ç¢¼ã€‚', 'ç™»å‡ºç¢ºèª', () => {
            localStorage.removeItem('myBillAppPassword');
            USER_PASSWORD = "";
            const overlay = document.getElementById('loginOverlay');
            overlay.style.display = 'flex';
            setTimeout(() => overlay.style.opacity = '1', 50);
            document.getElementById('passwordInput').value = '';
            const btn = document.getElementById('loginBtn');
            btn.disabled = false;
            btn.innerText = 'è§£é–';
            document.getElementById('listContainer').innerHTML = '';
            document.getElementById('totalAmount').textContent = '$0';
            allData = [];
        });
    }

    function verifyLogin(isAutoLogin = false) {
        const pass = document.getElementById('passwordInput').value;
        const errorMsg = document.getElementById('loginError');
        const btn = document.getElementById('loginBtn');

        if(!pass) { errorMsg.textContent = 'è«‹è¼¸å…¥å¯†ç¢¼'; return; }

        btn.disabled = true;
        btn.innerText = isAutoLogin ? 'è‡ªå‹•ç™»å…¥ä¸­...' : 'é©—è­‰ä¸­...';
        errorMsg.textContent = '';

        USER_PASSWORD = pass;
        loadData(true); 
    }

    function loadData(isInitialLogin = false) {
        const container = document.getElementById('listContainer');
        const loginBtn = document.getElementById('loginBtn');

        if (!isInitialLogin) {
            container.innerHTML = '<div class="loading-state">â˜ï¸ æ­£åœ¨é‡æ–°è¼‰å…¥è³‡æ–™...</div>';
        }
        
        const url = `${API_URL}?password=${encodeURIComponent(USER_PASSWORD)}`;

        fetch(url)
            .then(res => res.json())
            .then(data => {
                if(data.error) {
                    throw new Error(data.error);
                }
                
                localStorage.setItem('myBillAppPassword', USER_PASSWORD);
                
                if (isInitialLogin) {
                    const overlay = document.getElementById('loginOverlay');
                    overlay.style.opacity = '0';
                    setTimeout(() => { overlay.style.display = 'none'; }, 300);
                }

                allData = data.reverse();
                filterData();
                loginBtn.disabled = false;
                loginBtn.innerText = 'è§£é–';
            })
            .catch(err => {
                 console.error(err);
                 if (isInitialLogin) {
                    loginBtn.disabled = false;
                    loginBtn.innerText = 'è§£é–';
                    const errorMsg = document.getElementById('loginError');
                    
                    if (err.message && err.message.includes("å¯†ç¢¼")) {
                        errorMsg.textContent = 'âŒ å¯†ç¢¼éŒ¯èª¤';
                        localStorage.removeItem('myBillAppPassword');
                    } else if (err.message && err.message.includes("å·¥ä½œè¡¨åç¨±éŒ¯èª¤")) {
                        const sheetName = err.message.split('ï¼š')[1];
                        errorMsg.innerHTML = `âš ï¸ é€£ç·šéŒ¯èª¤ï¼šè«‹æª¢æŸ¥ GAS ä¸­çš„ <b>SHEET_NAME</b> æ˜¯å¦ç‚º <b>${sheetName}</b>`;
                    } else {
                        errorMsg.innerHTML = 'âš ï¸ ä¼ºæœå™¨é€£ç·šå¤±æ•—æˆ– GAS å°šæœªéƒ¨ç½²';
                    }
                 } else {
                    container.innerHTML = '<div class="loading-state">âš ï¸ è¼‰å…¥å¤±æ•—</div>';
                 }
            });
    }

    function submitData() {
        const bank = document.getElementById('bank').value;
        const amount = document.getElementById('amount').value;
        const note = document.getElementById('note').value;
        const paymentDate = document.getElementById('paymentDate').value;
        const targetMonth = document.getElementById('billMonthInput').value; 
        
        if(!bank || !amount) { showCustomAlert('è«‹è¼¸å…¥éŠ€è¡Œèˆ‡é‡‘é¡', 'è¼¸å…¥éŒ¯èª¤'); return; } // ä¿®æ­£ï¼šä½¿ç”¨è‡ªè¨‚å½ˆçª—

        const btn = document.getElementById('submitBtn');
        const originalText = btn.innerText;
        btn.disabled = true;
        btn.innerText = 'åŠ å¯†ä¸Šå‚³ä¸­...';

        document.getElementById('monthSelector').value = targetMonth;

        const tempObj = { 
            password: USER_PASSWORD,
            action: 'post',
            bank, amount: Number(amount), note, paymentDate, month: targetMonth
        };
        
        fetch(API_URL, {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(tempObj)
        }).then(() => {
            
            setTimeout(() => {
                loadData(); 
                btn.disabled = false;
                btn.innerText = originalText;
                document.getElementById('bank').value = '';
                document.getElementById('amount').value = '';
                document.getElementById('note').value = '';
            }, 1000); 

        }).catch(() => {
            showCustomAlert('ä¸Šå‚³è«‹æ±‚å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯ã€‚', 'éŒ¯èª¤'); // ä¿®æ­£ï¼šä½¿ç”¨è‡ªè¨‚å½ˆçª—
            btn.disabled = false;
            btn.innerText = originalText;
        });
    }

    function filterData() {
        const selectedMonth = document.getElementById('monthSelector').value;
        
        const filtered = allData.filter(item => String(item.month).trim() === selectedMonth);
        
        let total = 0;
        let html = '';
        filtered.forEach(item => {
            total += Number(item.amount);
            let dateTag = item.paymentDate ? `<span class="tag-date">ğŸ“… ${item.paymentDate}</span>` : '';
            
            html += `
                <div class="transaction-item">
                    <div class="t-info">
                        <div class="t-bank">${item.bank}</div>
                        <div class="tags-row">${dateTag}${item.note ? `<span class="t-note">${item.note}</span>` : ''}</div>
                    </div>
                    <div class="t-amount-group">
                        <div class="t-amount">$${Number(item.amount).toLocaleString()}</div>
                        <button class="btn-delete" onclick="deleteRecord(${item.rowIndex})">Ã—</button>
                    </div>
                </div>`;
        });
        document.getElementById('totalAmount').textContent = `$${total.toLocaleString()}`;
        document.getElementById('count').textContent = `${filtered.length} ç­†`;
        document.getElementById('listContainer').innerHTML = filtered.length ? html : '<div class="loading-state">æœ¬æœˆç„¡è³‡æ–™</div>';
    }
    
    // --- è¼”åŠ©å‡½å¼ (æ ¼å¼åŒ–ä¿®æ­£ YYYYMM) ---
    function setupBankAutocomplete() {
        const input = document.getElementById('bank');
        const box = document.getElementById('bankSuggestions');
        input.addEventListener('focus', () => renderSuggestions(input.value));
        input.addEventListener('input', (e) => renderSuggestions(e.target.value));
        document.addEventListener('click', (e) => { if (!input.contains(e.target) && !box.contains(e.target)) box.classList.remove('show'); });
        function renderSuggestions(text) {
            const filtered = text ? BANK_LIST.filter(b => b.toLowerCase().includes(text.trim().toLowerCase())) : BANK_LIST;
            if (filtered.length === 0) { box.classList.remove('show'); return; }
            filtered.forEach(bankName => {
                const div = document.createElement('div');
                div.className = 'suggestion-item';
                div.textContent = bankName;
                div.onclick = () => { input.value = bankName; box.classList.remove('show'); };
                box.appendChild(div);
            });
            box.classList.add('show');
        }
    }

    function initDateDropdown() {
        const select = document.getElementById('paymentDate');
        for (let i = 1; i <= 31; i++) {
            const option = document.createElement('option');
            option.value = i + "æ—¥"; option.text = i + "æ—¥"; select.appendChild(option);
        }
    }
    
    function setDefaultInputMonth() {
        const inputSelect = document.getElementById('billMonthInput');
        const viewSelect = document.getElementById('monthSelector');
        const date = new Date();
        const val = `${date.getFullYear()}${String(date.getMonth()+1).padStart(2,'0')}`;
        inputSelect.value = val; viewSelect.value = val;
    }
    
    function initMonthDropdown(id) {
        const select = document.getElementById(id);
        const date = new Date();
        date.setMonth(date.getMonth()+1);
        for(let i=0; i<20; i++) {
            const currentMonth = date.getMonth();
            const currentYear = date.getFullYear();
            const val = `${currentYear}${String(currentMonth+1).padStart(2,'0')}`;
            const opt = document.createElement('option'); 
            opt.value = val; 
            opt.text = `${currentYear}å¹´ ${String(currentMonth+1).padStart(2,'0')}æœˆ`;
            select.appendChild(opt); 
            date.setMonth(date.getMonth()-1);
        }
    }
</script>
</body>
</html>
